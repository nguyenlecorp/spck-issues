!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./htmlScanner","../utils/arrays","./htmlTags"],e)}(function(e,t){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function n(e){for(var t=r.createScanner(e),n=new i(0,e.length,[],void 0),a=n,s=-1,d=null,f=t.scan();f!==r.TokenType.EOS;){switch(f){case r.TokenType.StartTagOpen:var l=new i(t.getTokenOffset(),e.length,[],a);a.children.push(l),a=l;break;case r.TokenType.StartTag:a.tag=t.getTokenText();break;case r.TokenType.StartTagClose:a.end=t.getTokenEnd(),o.isEmptyElement(a.tag)&&a.parent&&(a.closed=!0,a=a.parent);break;case r.TokenType.EndTagOpen:s=t.getTokenOffset();break;case r.TokenType.EndTag:for(var c=t.getTokenText().toLowerCase();!a.isSameTag(c)&&a.parent;)a.end=s,a.closed=!1,a=a.parent;a!==n&&(a.closed=!0,a.endTagStart=s);break;case r.TokenType.StartTagSelfClose:a.parent&&(a.closed=!0,a.end=t.getTokenEnd(),a=a.parent);break;case r.TokenType.EndTagClose:a.parent&&(a.end=t.getTokenEnd(),a=a.parent);break;case r.TokenType.AttributeName:var u=(d=t.getTokenText(),a.attributes);u||(a.attributes=u={}),u[d]=null;break;case r.TokenType.AttributeValue:var p=t.getTokenText(),u=a.attributes;u&&d&&(u[d]=p,d=null)}f=t.scan()}for(;a.parent;)a.end=e.length,a.closed=!1,a=a.parent;return{roots:n.children,findNodeBefore:n.findNodeBefore.bind(n),findNodeAt:n.findNodeAt.bind(n)}}Object.defineProperty(t,"__esModule",{value:!0});var r=e("./htmlScanner"),a=e("../utils/arrays"),o=e("./htmlTags"),i=function(){function e(e,t,n,r){this.start=e,this.end=t,this.children=n,this.parent=r}return Object.defineProperty(e.prototype,"attributeNames",{get:function(){return this.attributes?Object.keys(this.attributes):[]},enumerable:!0,configurable:!0}),e.prototype.isSameTag=function(e){return this.tag&&e&&this.tag.length===e.length&&this.tag.toLowerCase()===e},Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length?this.children[this.children.length-1]:void 0},enumerable:!0,configurable:!0}),e.prototype.findNodeBefore=function(e){var t=a.findFirst(this.children,function(t){return e<=t.start})-1;if(t>=0){var n=this.children[t];if(e>n.start){if(e<n.end)return n.findNodeBefore(e);var r=n.lastChild;return r&&r.end===n.end?n.findNodeBefore(e):n}}return this},e.prototype.findNodeAt=function(e){var t=a.findFirst(this.children,function(t){return e<=t.start})-1;if(t>=0){var n=this.children[t];if(e>n.start&&e<=n.end)return n.findNodeAt(e)}return this},e}();t.Node=i,t.parse=n});