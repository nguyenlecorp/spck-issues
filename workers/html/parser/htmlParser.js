!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./htmlScanner","../utils/arrays","./htmlTags"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./htmlScanner"),r=e("../utils/arrays"),a=e("./htmlTags"),o=function(){function e(e,t,n,r){this.start=e,this.end=t,this.children=n,this.parent=r}return Object.defineProperty(e.prototype,"attributeNames",{get:function(){return this.attributes?Object.keys(this.attributes):[]},enumerable:!0,configurable:!0}),e.prototype.isSameTag=function(e){return this.tag&&e&&this.tag.length===e.length&&this.tag.toLowerCase()===e},Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length?this.children[this.children.length-1]:void 0},enumerable:!0,configurable:!0}),e.prototype.findNodeBefore=function(e){var t=r.findFirst(this.children,function(t){return e<=t.start})-1;if(t>=0){var n=this.children[t];if(e>n.start){if(e<n.end)return n.findNodeBefore(e);var a=n.lastChild;return a&&a.end===n.end?n.findNodeBefore(e):n}}return this},e.prototype.findNodeAt=function(e){var t=r.findFirst(this.children,function(t){return e<=t.start})-1;if(t>=0){var n=this.children[t];if(e>n.start&&e<=n.end)return n.findNodeAt(e)}return this},e}();t.Node=o,t.parse=function(e){for(var t=n.createScanner(e),r=new o(0,e.length,[],void 0),i=r,s=-1,d=null,f=t.scan();f!==n.TokenType.EOS;){switch(f){case n.TokenType.StartTagOpen:var l=new o(t.getTokenOffset(),e.length,[],i);i.children.push(l),i=l;break;case n.TokenType.StartTag:i.tag=t.getTokenText();break;case n.TokenType.StartTagClose:i.end=t.getTokenEnd(),a.isEmptyElement(i.tag)&&i.parent&&(i.closed=!0,i=i.parent);break;case n.TokenType.EndTagOpen:s=t.getTokenOffset();break;case n.TokenType.EndTag:for(var c=t.getTokenText().toLowerCase();!i.isSameTag(c)&&i.parent;)i.end=s,i.closed=!1,i=i.parent;i!==r&&(i.closed=!0,i.endTagStart=s);break;case n.TokenType.StartTagSelfClose:i.parent&&(i.closed=!0,i.end=t.getTokenEnd(),i=i.parent);break;case n.TokenType.EndTagClose:i.parent&&(i.end=t.getTokenEnd(),i=i.parent);break;case n.TokenType.AttributeName:d=t.getTokenText(),(p=i.attributes)||(i.attributes=p={}),p[d]=null;break;case n.TokenType.AttributeValue:var u=t.getTokenText(),p=i.attributes;p&&d&&(p[d]=u,d=null)}f=t.scan()}for(;i.parent;)i.end=e.length,i.closed=!1,i=i.parent;return{roots:r.children,findNodeBefore:r.findNodeBefore.bind(r),findNodeAt:r.findNodeAt.bind(r)}}});