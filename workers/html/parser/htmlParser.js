!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./htmlScanner","../utils/arrays","./htmlTags"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=e("./htmlScanner"),a=e("../utils/arrays"),u=e("./htmlTags"),p=function(){function e(e,t,n,r){this.start=e,this.end=t,this.children=n,this.parent=r}return Object.defineProperty(e.prototype,"attributeNames",{get:function(){return this.attributes?Object.keys(this.attributes):[]},enumerable:!0,configurable:!0}),e.prototype.isSameTag=function(e){return this.tag&&e&&this.tag.length===e.length&&this.tag.toLowerCase()===e},Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length?this.children[this.children.length-1]:void 0},enumerable:!0,configurable:!0}),e.prototype.findNodeBefore=function(t){var e=a.findFirst(this.children,function(e){return t<=e.start})-1;if(0<=e){var n=this.children[e];if(t>n.start){if(t<n.end)return n.findNodeBefore(t);var r=n.lastChild;return r&&r.end===n.end?n.findNodeBefore(t):n}}return this},e.prototype.findNodeAt=function(t){var e=a.findFirst(this.children,function(e){return t<=e.start})-1;if(0<=e){var n=this.children[e];if(t>n.start&&t<=n.end)return n.findNodeAt(t)}return this},e}();t.Node=p,t.parse=function(e){for(var t=c.createScanner(e),n=new p(0,e.length,[],void 0),r=n,a=-1,o=null,i=t.scan();i!==c.TokenType.EOS;){switch(i){case c.TokenType.StartTagOpen:var s=new p(t.getTokenOffset(),e.length,[],r);r.children.push(s),r=s;break;case c.TokenType.StartTag:r.tag=t.getTokenText();break;case c.TokenType.StartTagClose:r.end=t.getTokenEnd(),u.isEmptyElement(r.tag)&&r.parent&&(r.closed=!0,r=r.parent);break;case c.TokenType.EndTagOpen:a=t.getTokenOffset();break;case c.TokenType.EndTag:for(var d=t.getTokenText().toLowerCase();!r.isSameTag(d)&&r.parent;)r.end=a,r.closed=!1,r=r.parent;r!==n&&(r.closed=!0,r.endTagStart=a);break;case c.TokenType.StartTagSelfClose:r.parent&&(r.closed=!0,r.end=t.getTokenEnd(),r=r.parent);break;case c.TokenType.EndTagClose:r.parent&&(r.end=t.getTokenEnd(),r=r.parent);break;case c.TokenType.AttributeName:o=t.getTokenText(),(f=r.attributes)||(r.attributes=f={}),f[o]=null;break;case c.TokenType.AttributeValue:var f,l=t.getTokenText();(f=r.attributes)&&o&&(f[o]=l,o=null)}i=t.scan()}for(;r.parent;)r.end=e.length,r.closed=!1,r=r.parent;return{roots:n.children,findNodeBefore:n.findNodeBefore.bind(n),findNodeAt:n.findNodeAt.bind(n)}}});