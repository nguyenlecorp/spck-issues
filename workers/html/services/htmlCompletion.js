!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","vscode-languageserver-types","../parser/htmlScanner","../parser/htmlTags","./tagProviders","../parser/htmlEntities","vscode-nls","../utils/strings"],e)}(function(e,t){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";function n(e,t,n,r){function l(t,n){return void 0===n&&(n=F),t>F&&(t=F),{start:e.positionAt(t),end:e.positionAt(n)}}function k(e,t){var n=l(e,t);return C.forEach(function(e){e.collectTags(function(e,t){A.items.push({label:e,kind:T.CompletionItemKind.Property,documentation:t,textEdit:T.TextEdit.replace(n,e),insertTextFormat:T.InsertTextFormat.PlainText})})}),A}function m(e){for(var t=e;t>0;){var n=I.charAt(t-1);if("\n\r".indexOf(n)>=0)return I.substring(t,e);if(!a(n))return null;t--}return I.substring(0,e)}function E(e,t,n){void 0===n&&(n=F);var r=l(e,n),a=o(I,n,f.ScannerState.WithinEndTag,f.TokenType.EndTagClose)?"":">",i=P;for(t&&(i=i.parent);i;){var s=i.tag;if(s&&(!i.closed||i.endTagStart>F)){var c={label:"/"+s,kind:T.CompletionItemKind.Property,filterText:"/"+s+a,textEdit:T.TextEdit.replace(r,"/"+s+a),insertTextFormat:T.InsertTextFormat.PlainText},u=m(i.start),d=m(e-1);if(null!==u&&null!==d&&u!==d){var g=u+"</"+s+a;c.textEdit=T.TextEdit.replace(l(e-1-d.length),g),c.filterText=d+"</"+s+a}return A.items.push(c),A}i=i.parent}return t?A:(C.forEach(function(e){e.collectTags(function(e,t){A.items.push({label:"/"+e,kind:T.CompletionItemKind.Property,documentation:t,filterText:"/"+e+a,textEdit:T.TextEdit.replace(r,"/"+e+a),insertTextFormat:T.InsertTextFormat.PlainText})})}),A)}function x(e,t){return k(e,t),E(e,!0,t),A}function v(e,t){void 0===t&&(t=F);for(var n=F;n<t&&"<"!==I[n];)n++;var r=l(e,n),a=o(I,t,f.ScannerState.AfterAttributeName,f.TokenType.DelimiterAssign)?"":'="$1"',i=W.toLowerCase();return C.forEach(function(e){e.collectAttributes(i,function(e,t){var n,o=e;"v"!==t&&a.length&&(o+=a,t&&(n={title:"Suggest",command:"editor.action.triggerSuggest"})),A.items.push({label:e,kind:"handler"===t?T.CompletionItemKind.Function:T.CompletionItemKind.Value,textEdit:T.TextEdit.replace(r,o),insertTextFormat:T.InsertTextFormat.Snippet,command:n})})}),S(r),A}function S(e){function t(e){e.attributeNames.forEach(function(e){g.startsWith(e,r)&&!a[e]&&(a[e]=e+'="$1"')}),e.children.forEach(function(e){return t(e)})}var r="data-",a={};a[r]=r+'$1="$2"',n&&n.roots.forEach(function(e){return t(e)}),Object.keys(a).forEach(function(t){return A.items.push({label:t,kind:T.CompletionItemKind.Value,textEdit:T.TextEdit.replace(e,a[t]),insertTextFormat:T.InsertTextFormat.Snippet})})}function h(e,t){void 0===t&&(t=F);var n,r;if(F>e&&F<=t&&'"'===I[e]){t>F&&'"'===I[t-1]&&t--;var a=i(I,F,e+1),o=s(I,F,t);n=l(a,o),r=!1}else n=l(e,t),r=!0;var f=W.toLowerCase(),c=K.toLowerCase();return C.forEach(function(e){e.collectValues(f,c,function(e){var t=r?'"'+e+'"':e;A.items.push({label:e,filterText:t,kind:T.CompletionItemKind.Unit,textEdit:T.TextEdit.replace(n,t),insertTextFormat:T.InsertTextFormat.PlainText})})}),O(),A}function y(e){return F===N.getTokenEnd()&&($=N.scan())===e&&N.getTokenOffset()===F?N.getTokenEnd():F}function b(){return O()}function O(){for(var e=F-1,n=t.character;e>=0&&g.isLetterOrDigit(I,e);)e--,n--;if(e>=0&&"&"===I[e]){var r=T.Range.create(T.Position.create(t.line,n-1),t);for(var a in d.entities)if(g.endsWith(a,";")){var o="&"+a;A.items.push({label:o,kind:T.CompletionItemKind.Keyword,documentation:p("entity.propose","Character entity representing '"+d.entities[a]+"'"),textEdit:T.TextEdit.replace(r,o),insertTextFormat:T.InsertTextFormat.PlainText})}}return A}var A={isIncomplete:!1,items:[]},C=u.allTagProviders.filter(function(t){return t.isApplicable(e.languageId)&&(!r||!1!==r[t.getId()])}),I=e.getText(),F=e.offsetAt(t),P=n.findNodeBefore(F);if(!P)return A;for(var K,N=f.createScanner(I,P.start),W="",$=N.scan();$!==f.TokenType.EOS&&N.getTokenOffset()<=F;){switch($){case f.TokenType.StartTagOpen:if(N.getTokenEnd()===F){var w=y(f.TokenType.StartTag);return x(F,w)}break;case f.TokenType.StartTag:if(N.getTokenOffset()<=F&&F<=N.getTokenEnd())return k(N.getTokenOffset(),N.getTokenEnd());W=N.getTokenText();break;case f.TokenType.AttributeName:if(N.getTokenOffset()<=F&&F<=N.getTokenEnd())return v(N.getTokenOffset(),N.getTokenEnd());K=N.getTokenText();break;case f.TokenType.DelimiterAssign:if(N.getTokenEnd()===F)return h(N.getTokenEnd());break;case f.TokenType.AttributeValue:if(N.getTokenOffset()<=F&&F<=N.getTokenEnd())return h(N.getTokenOffset(),N.getTokenEnd());break;case f.TokenType.Whitespace:if(F<=N.getTokenEnd())switch(N.getScannerState()){case f.ScannerState.AfterOpeningStartTag:return x(N.getTokenOffset(),y(f.TokenType.StartTag));case f.ScannerState.WithinTag:case f.ScannerState.AfterAttributeName:return v(N.getTokenEnd());case f.ScannerState.BeforeAttributeValue:return h(N.getTokenEnd());case f.ScannerState.AfterOpeningEndTag:return E(N.getTokenOffset()-1,!1);case f.ScannerState.WithinContent:return b()}break;case f.TokenType.EndTagOpen:if(F<=N.getTokenEnd()){return E(N.getTokenOffset()+1,!1,y(f.TokenType.EndTag))}break;case f.TokenType.EndTag:if(F<=N.getTokenEnd())for(var B=N.getTokenOffset()-1;B>=0;){var V=I.charAt(B);if("/"===V)return E(B,!1,N.getTokenEnd());if(!a(V))break;B--}break;case f.TokenType.StartTagClose:if(F<=N.getTokenEnd()&&W)return function(t,n){if(r&&r.hideAutoCompleteProposals)return A;if(!c.isEmptyElement(n)){var a=e.positionAt(t);A.items.push({label:"</"+n+">",kind:T.CompletionItemKind.Property,filterText:"</"+n+">",textEdit:T.TextEdit.insert(a,"$0</"+n+">"),insertTextFormat:T.InsertTextFormat.Snippet})}return A}(N.getTokenEnd(),W);break;case f.TokenType.Content:if(F<=N.getTokenEnd())return b();break;default:if(F<=N.getTokenEnd())return A}$=N.scan()}return A}function r(e,t,n){var r=e.offsetAt(t);if(r<=0)return null;var a=e.getText().charAt(r-1);if(">"===a){var o=n.findNodeBefore(r);if(o&&o.tag&&!c.isEmptyElement(o.tag)&&o.start<r&&(!o.endTagStart||o.endTagStart>r))for(var i=f.createScanner(e.getText(),o.start),s=i.scan();s!==f.TokenType.EOS&&i.getTokenEnd()<=r;){if(s===f.TokenType.StartTagClose&&i.getTokenEnd()===r)return"$0</"+o.tag+">";s=i.scan()}}else if("/"===a){for(var o=n.findNodeBefore(r);o&&o.closed;)o=o.parent;if(o&&o.tag)for(var i=f.createScanner(e.getText(),o.start),s=i.scan();s!==f.TokenType.EOS&&i.getTokenEnd()<=r;){if(s===f.TokenType.EndTagOpen&&i.getTokenEnd()===r)return o.tag+">";s=i.scan()}}return null}function a(e){return/^\s*$/.test(e)}function o(e,t,n,r){for(var a=f.createScanner(e,t,n),o=a.scan();o===f.TokenType.Whitespace;)o=a.scan();return o===r}function i(e,t,n){for(;t>n&&!a(e[t-1]);)t--;return t}function s(e,t,n){for(;t<n&&!a(e[t]);)t++;return t}Object.defineProperty(t,"__esModule",{value:!0});var T=e("vscode-languageserver-types"),f=e("../parser/htmlScanner"),c=e("../parser/htmlTags"),u=e("./tagProviders"),d=e("../parser/htmlEntities"),l=e("vscode-nls"),g=e("../utils/strings"),p=l.loadMessageBundle();t.doComplete=n,t.doTagComplete=r});