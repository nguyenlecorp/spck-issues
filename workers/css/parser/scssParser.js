var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./scssScanner","./cssScanner","./cssParser","./cssNodes","./scssErrors","./cssErrors"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./scssScanner"),a=e("./cssScanner"),r=e("./cssParser"),o=e("./cssNodes"),s=e("./scssErrors"),p=e("./cssErrors"),i=function(i){function e(){return i.call(this,new n.SCSSScanner)||this}return __extends(e,i),e.prototype._parseStylesheetStatement=function(){var e=i.prototype._parseStylesheetStatement.call(this);return e||(this.peek(a.TokenType.AtKeyword)?this._parseWarnAndDebug()||this._parseControlStatement()||this._parseMixinDeclaration()||this._parseMixinContent()||this._parseMixinReference()||this._parseFunctionDeclaration():this._parseVariableDeclaration())},e.prototype._parseImport=function(){if(!this.peekKeyword("@import"))return null;var e=this.create(o.Import);if(this.consumeToken(),!e.addChild(this._parseURILiteral())&&!e.addChild(this._parseStringLiteral()))return this.finish(e,p.ParseError.URIOrStringExpected);for(;this.accept(a.TokenType.Comma);)if(!e.addChild(this._parseURILiteral())&&!e.addChild(this._parseStringLiteral()))return this.finish(e,p.ParseError.URIOrStringExpected);return this.peek(a.TokenType.SemiColon)||this.peek(a.TokenType.EOF)||e.setMedialist(this._parseMediaQueryList()),this.finish(e)},e.prototype._parseVariableDeclaration=function(e){if(void 0===e&&(e=[]),!this.peek(n.VariableName))return null;var t=this.create(o.VariableDeclaration);if(!t.setVariable(this._parseVariable()))return null;if(!this.accept(a.TokenType.Colon))return this.finish(t,p.ParseError.ColonExpected);if(t.colonPosition=this.prevToken.offset,!t.setValue(this._parseExpr()))return this.finish(t,p.ParseError.VariableValueExpected,[],e);for(;this.accept(a.TokenType.Exclamation);){if(!this.peekRegExp(a.TokenType.Ident,/^(default|global)$/))return this.finish(t,p.ParseError.UnknownKeyword);this.consumeToken()}return this.peek(a.TokenType.SemiColon)&&(t.semicolonPosition=this.token.offset),this.finish(t)},e.prototype._parseMediaFeatureName=function(){return this._parseFunction()||this._parseIdent()||this._parseVariable()},e.prototype._parseKeyframeSelector=function(){return this._tryParseKeyframeSelector()||this._parseControlStatement(this._parseKeyframeSelector.bind(this))||this._parseMixinContent()},e.prototype._parseVariable=function(){if(!this.peek(n.VariableName))return null;var e=this.create(o.Variable);return this.consumeToken(),e},e.prototype._parseIdent=function(e){var t=this;if(!this.peek(a.TokenType.Ident)&&!this.peek(n.InterpolationFunction)&&!this.peekDelim("-"))return null;var r=this.create(o.Identifier);r.referenceTypes=e;for(var i=!1,s=function(){return t.acceptDelim("-")?(!t.hasWhitespace()&&t.acceptDelim("-")&&(r.isCustomProperty=!0),t.hasWhitespace()?null:t._parseInterpolation()):null};(this.accept(a.TokenType.Ident)||r.addChild(this._parseInterpolation()||this.try(s)))&&(i=!0,!this.hasWhitespace()&&this.acceptDelim("-"),!this.hasWhitespace()););return i?this.finish(r):null},e.prototype._parseTerm=function(){var e=i.prototype._parseTerm.call(this);return e||((e=this.create(o.Term)).setExpression(this._parseVariable())||e.setExpression(this._parseSelectorCombinator())||e.setExpression(this._tryParsePrio())?this.finish(e):null)},e.prototype._parseInterpolation=function(){if(this.peek(n.InterpolationFunction)){var e=this.create(o.Interpolation);return this.consumeToken(),e.addChild(this._parseBinaryExpr())||this._parseSelectorCombinator()?this.accept(a.TokenType.CurlyR)?this.finish(e):this.finish(e,p.ParseError.RightCurlyExpected):this.finish(e,p.ParseError.ExpressionExpected)}return null},e.prototype._parseOperator=function(){if(this.peek(n.EqualsOperator)||this.peek(n.NotEqualsOperator)||this.peek(n.GreaterEqualsOperator)||this.peek(n.SmallerEqualsOperator)||this.peekDelim(">")||this.peekDelim("<")||this.peekIdent("and")||this.peekIdent("or")||this.peekDelim("%")){var e=this.createNode(o.NodeType.Operator);return this.consumeToken(),this.finish(e)}return i.prototype._parseOperator.call(this)},e.prototype._parseUnaryOperator=function(){if(this.peekIdent("not")){var e=this.create(o.Node);return this.consumeToken(),this.finish(e)}return i.prototype._parseUnaryOperator.call(this)},e.prototype._parseRuleSetDeclaration=function(){return this.peek(a.TokenType.AtKeyword)?this._parseKeyframe()||this._parseImport()||this._parseMedia(!0)||this._parseFontFace()||this._parseWarnAndDebug()||this._parseControlStatement()||this._parseFunctionDeclaration()||this._parseExtends()||this._parseMixinReference()||this._parseMixinContent()||this._parseMixinDeclaration()||this._parseRuleset(!0)||this._parseSupports(!0):this._parseVariableDeclaration()||this._tryParseRuleset(!0)||i.prototype._parseRuleSetDeclaration.call(this)},e.prototype._parseDeclaration=function(e){var t=this.create(o.Declaration);if(!t.setProperty(this._parseProperty()))return null;if(!this.accept(a.TokenType.Colon))return this.finish(t,p.ParseError.ColonExpected,[a.TokenType.Colon],e);t.colonPosition=this.prevToken.offset;var r=!1;if(t.setValue(this._parseExpr())&&(r=!0,t.addChild(this._parsePrio())),this.peek(a.TokenType.CurlyL))t.setNestedProperties(this._parseNestedProperties());else if(!r)return this.finish(t,p.ParseError.PropertyValueExpected);return this.peek(a.TokenType.SemiColon)&&(t.semicolonPosition=this.token.offset),this.finish(t)},e.prototype._parseNestedProperties=function(){var e=this.create(o.NestedProperties);return this._parseBody(e,this._parseDeclaration.bind(this))},e.prototype._parseExtends=function(){if(this.peekKeyword("@extend")){var e=this.create(o.ExtendsReference);if(this.consumeToken(),!e.getSelectors().addChild(this._parseSimpleSelector()))return this.finish(e,p.ParseError.SelectorExpected);for(;this.accept(a.TokenType.Comma);)e.getSelectors().addChild(this._parseSimpleSelector());return this.accept(a.TokenType.Exclamation)&&!this.acceptIdent("optional")?this.finish(e,p.ParseError.UnknownKeyword):this.finish(e)}return null},e.prototype._parseSimpleSelectorBody=function(){return this._parseSelectorCombinator()||this._parseSelectorPlaceholder()||i.prototype._parseSimpleSelectorBody.call(this)},e.prototype._parseSelectorCombinator=function(){if(this.peekDelim("&")){var e=this.createNode(o.NodeType.SelectorCombinator);for(this.consumeToken();!this.hasWhitespace()&&(this.acceptDelim("-")||this.accept(a.TokenType.Num)||this.accept(a.TokenType.Dimension)||e.addChild(this._parseIdent())||this.acceptDelim("&")););return this.finish(e)}return null},e.prototype._parseSelectorPlaceholder=function(){if(this.peekDelim("%")){var e=this.createNode(o.NodeType.SelectorPlaceholder);return this.consumeToken(),this._parseIdent(),this.finish(e)}if(this.peekKeyword("@at-root")){e=this.createNode(o.NodeType.SelectorPlaceholder);return this.consumeToken(),this.finish(e)}return null},e.prototype._parseWarnAndDebug=function(){if(!this.peekKeyword("@debug")&&!this.peekKeyword("@warn")&&!this.peekKeyword("@error"))return null;var e=this.createNode(o.NodeType.Debug);return this.consumeToken(),e.addChild(this._parseExpr()),this.finish(e)},e.prototype._parseControlStatement=function(e){return void 0===e&&(e=this._parseRuleSetDeclaration.bind(this)),this.peek(a.TokenType.AtKeyword)?this._parseIfStatement(e)||this._parseForStatement(e)||this._parseEachStatement(e)||this._parseWhileStatement(e):null},e.prototype._parseIfStatement=function(e){return this.peekKeyword("@if")?this._internalParseIfStatement(e):null},e.prototype._internalParseIfStatement=function(e){var t=this.create(o.IfStatement);if(this.consumeToken(),!t.setExpression(this._parseExpr(!0)))return this.finish(t,p.ParseError.ExpressionExpected);if(this._parseBody(t,e),this.acceptKeyword("@else"))if(this.peekIdent("if"))t.setElseClause(this._internalParseIfStatement(e));else if(this.peek(a.TokenType.CurlyL)){var r=this.create(o.ElseStatement);this._parseBody(r,e),t.setElseClause(r)}return this.finish(t)},e.prototype._parseForStatement=function(e){if(!this.peekKeyword("@for"))return null;var t=this.create(o.ForStatement);return this.consumeToken(),t.setVariable(this._parseVariable())?this.acceptIdent("from")?t.addChild(this._parseBinaryExpr())?this.acceptIdent("to")||this.acceptIdent("through")?t.addChild(this._parseBinaryExpr())?this._parseBody(t,e):this.finish(t,p.ParseError.ExpressionExpected,[a.TokenType.CurlyR]):this.finish(t,s.SCSSParseError.ThroughOrToExpected,[a.TokenType.CurlyR]):this.finish(t,p.ParseError.ExpressionExpected,[a.TokenType.CurlyR]):this.finish(t,s.SCSSParseError.FromExpected,[a.TokenType.CurlyR]):this.finish(t,p.ParseError.VariableNameExpected,[a.TokenType.CurlyR])},e.prototype._parseEachStatement=function(e){if(!this.peekKeyword("@each"))return null;var t=this.create(o.EachStatement);this.consumeToken();var r=t.getVariables();if(!r.addChild(this._parseVariable()))return this.finish(t,p.ParseError.VariableNameExpected,[a.TokenType.CurlyR]);for(;this.accept(a.TokenType.Comma);)if(!r.addChild(this._parseVariable()))return this.finish(t,p.ParseError.VariableNameExpected,[a.TokenType.CurlyR]);return this.finish(r),this.acceptIdent("in")?t.addChild(this._parseExpr())?this._parseBody(t,e):this.finish(t,p.ParseError.ExpressionExpected,[a.TokenType.CurlyR]):this.finish(t,s.SCSSParseError.InExpected,[a.TokenType.CurlyR])},e.prototype._parseWhileStatement=function(e){if(!this.peekKeyword("@while"))return null;var t=this.create(o.WhileStatement);return this.consumeToken(),t.addChild(this._parseBinaryExpr())?this._parseBody(t,e):this.finish(t,p.ParseError.ExpressionExpected,[a.TokenType.CurlyR])},e.prototype._parseFunctionBodyDeclaration=function(){return this._parseVariableDeclaration()||this._parseReturnStatement()||this._parseWarnAndDebug()||this._parseControlStatement(this._parseFunctionBodyDeclaration.bind(this))},e.prototype._parseFunctionDeclaration=function(){if(!this.peekKeyword("@function"))return null;var e=this.create(o.FunctionDeclaration);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([o.ReferenceType.Function])))return this.finish(e,p.ParseError.IdentifierExpected,[a.TokenType.CurlyR]);if(!this.accept(a.TokenType.ParenthesisL))return this.finish(e,p.ParseError.LeftParenthesisExpected,[a.TokenType.CurlyR]);if(e.getParameters().addChild(this._parseParameterDeclaration()))for(;this.accept(a.TokenType.Comma);)if(!e.getParameters().addChild(this._parseParameterDeclaration()))return this.finish(e,p.ParseError.VariableNameExpected);return this.accept(a.TokenType.ParenthesisR)?this._parseBody(e,this._parseFunctionBodyDeclaration.bind(this)):this.finish(e,p.ParseError.RightParenthesisExpected,[a.TokenType.CurlyR])},e.prototype._parseReturnStatement=function(){if(!this.peekKeyword("@return"))return null;var e=this.createNode(o.NodeType.ReturnStatement);return this.consumeToken(),e.addChild(this._parseExpr())?this.finish(e):this.finish(e,p.ParseError.ExpressionExpected)},e.prototype._parseMixinDeclaration=function(){if(!this.peekKeyword("@mixin"))return null;var e=this.create(o.MixinDeclaration);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([o.ReferenceType.Mixin])))return this.finish(e,p.ParseError.IdentifierExpected,[a.TokenType.CurlyR]);if(this.accept(a.TokenType.ParenthesisL)){if(e.getParameters().addChild(this._parseParameterDeclaration()))for(;this.accept(a.TokenType.Comma);)if(!e.getParameters().addChild(this._parseParameterDeclaration()))return this.finish(e,p.ParseError.VariableNameExpected);if(!this.accept(a.TokenType.ParenthesisR))return this.finish(e,p.ParseError.RightParenthesisExpected,[a.TokenType.CurlyR])}return this._parseBody(e,this._parseRuleSetDeclaration.bind(this))},e.prototype._parseParameterDeclaration=function(){var e=this.create(o.FunctionParameter);return e.setIdentifier(this._parseVariable())?(this.accept(n.Ellipsis),this.accept(a.TokenType.Colon)&&!e.setDefaultValue(this._parseExpr(!0))?this.finish(e,p.ParseError.VariableValueExpected,[],[a.TokenType.Comma,a.TokenType.ParenthesisR]):this.finish(e)):null},e.prototype._parseMixinContent=function(){if(!this.peekKeyword("@content"))return null;var e=this.createNode(o.NodeType.MixinContent);return this.consumeToken(),this.finish(e)},e.prototype._parseMixinReference=function(){if(!this.peekKeyword("@include"))return null;var e=this.create(o.MixinReference);if(this.consumeToken(),!e.setIdentifier(this._parseIdent([o.ReferenceType.Mixin])))return this.finish(e,p.ParseError.IdentifierExpected,[a.TokenType.CurlyR]);if(this.accept(a.TokenType.ParenthesisL)){if(e.getArguments().addChild(this._parseFunctionArgument()))for(;this.accept(a.TokenType.Comma);)if(!e.getArguments().addChild(this._parseFunctionArgument()))return this.finish(e,p.ParseError.ExpressionExpected);if(!this.accept(a.TokenType.ParenthesisR))return this.finish(e,p.ParseError.RightParenthesisExpected)}if(this.peek(a.TokenType.CurlyL)){var t=this.create(o.BodyDeclaration);this._parseBody(t,this._parseMixinReferenceBodyStatement.bind(this)),e.setContent(t)}return this.finish(e)},e.prototype._parseMixinReferenceBodyStatement=function(){return this._tryParseKeyframeSelector()||this._parseRuleSetDeclaration()},e.prototype._parseFunctionArgument=function(){var e=this.create(o.FunctionArgument),t=this.mark(),r=this._parseVariable();if(r)if(this.accept(a.TokenType.Colon))e.setIdentifier(r);else{if(this.accept(n.Ellipsis))return e.setValue(r),this.finish(e);this.restoreAtMark(t)}return e.setValue(this._parseExpr(!0))?(e.addChild(this._parsePrio()),this.finish(e)):null},e.prototype._parseURLArgument=function(){var e=this.mark(),t=i.prototype._parseURLArgument.call(this);if(!t||!this.peek(a.TokenType.ParenthesisR)){this.restoreAtMark(e);var r=this.create(o.Node);return r.addChild(this._parseBinaryExpr()),this.finish(r)}return t},e.prototype._parseOperation=function(){if(!this.peek(a.TokenType.ParenthesisL))return null;var e=this.create(o.Node);for(this.consumeToken();e.addChild(this._parseListElement());)this.accept(a.TokenType.Comma);return this.accept(a.TokenType.ParenthesisR)?this.finish(e):this.finish(e,p.ParseError.RightParenthesisExpected)},e.prototype._parseListElement=function(){var e=this.createNode(o.NodeType.ListEntry);return e.addChild(this._parseBinaryExpr())?this.accept(a.TokenType.Colon)&&!e.addChild(this._parseBinaryExpr())?this.finish(e,p.ParseError.ExpressionExpected):this.finish(e):null},e}(r.Parser);t.SCSSParser=i});