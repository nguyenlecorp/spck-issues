!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./languageFacts","./lintRules","../parser/cssNodes","vscode-nls"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var ae=e("./languageFacts"),se=e("./lintRules"),le=e("../parser/cssNodes"),de=e("vscode-nls").loadMessageBundle(),ue=function(e,t){this.name=e,this.node=t},fe=function(){function e(){this.data={}}return e.prototype.add=function(e,t,r){var n=this.data[e];n||(n={nodes:[],names:[]},this.data[e]=n),n.names.push(t),r&&n.nodes.push(r)},e}(),r=function(){function oe(e,t){this.warnings=[],this.settings=t,this.documentText=e.getText(),this.keyframes=new fe}return oe.entries=function(e,t,r,n){var i=new oe(t,r);return e.acceptVisitor(i),i.completeValidations(),i.getEntries(n)},oe.prototype.fetch=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o.name===t&&r.push(o)}return r},oe.prototype.fetchWithValue=function(e,t,r){for(var n=[],i=0,o=e;i<o.length;i++){var a=o[i];if(a.name===t){var s=a.node.getValue();s&&this.findValueInExpression(s,r)&&n.push(a)}}return n},oe.prototype.findValueInExpression=function(e,t){var r=!1;return e.accept(function(e){return e.type===le.NodeType.Identifier&&e.getText()===t&&(r=!0),!r}),r},oe.prototype.getEntries=function(t){return void 0===t&&(t=le.Level.Warning|le.Level.Error),this.warnings.filter(function(e){return 0!=(e.getLevel()&t)})},oe.prototype.addEntry=function(e,t,r){var n=new le.Marker(e,t,this.settings.get(t),r);this.warnings.push(n)},oe.prototype.getMissingNames=function(e,t){e=e.slice(0);for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);-1!==n&&(e[n]=null)}var i=null;for(r=0;r<e.length;r++){var o=e[r];o&&(i=null===i?de("namelist.single","'{0}'",o):de("namelist.concatenated","{0}, '{1}'",i,o))}return i},oe.prototype.visitNode=function(e){switch(e.type){case le.NodeType.Keyframe:return this.visitKeyframe(e);case le.NodeType.FontFace:return this.visitFontFace(e);case le.NodeType.Ruleset:return this.visitRuleSet(e);case le.NodeType.SimpleSelector:return this.visitSimpleSelector(e);case le.NodeType.Function:return this.visitFunction(e);case le.NodeType.NumericValue:return this.visitNumericValue(e);case le.NodeType.Import:return this.visitImport(e);case le.NodeType.HexColorValue:return this.visitHexColorValue(e);case le.NodeType.Prio:return this.visitPrio(e)}return!0},oe.prototype.completeValidations=function(){this.validateKeyframes()},oe.prototype.visitKeyframe=function(e){var t=e.getKeyword(),r=t.getText();return this.keyframes.add(e.getName(),r,"@keyframes"!==r?t:null),!0},oe.prototype.validateKeyframes=function(){var e=["@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"];for(var t in this.keyframes.data){var r=this.keyframes.data[t].names,n=-1===r.indexOf("@keyframes");if(n||1!==r.length){var i=this.getMissingNames(e,r);if(i||n)for(var o=0,a=this.keyframes.data[t].nodes;o<a.length;o++){var s=a[o];if(n){var l=de("keyframes.standardrule.missing","Always define standard rule '@keyframes' when defining keyframes.");this.addEntry(s,se.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,l)}if(i){l=de("keyframes.vendorspecific.missing","Always include all vendor specific rules: Missing: {0}",i);this.addEntry(s,se.Rules.AllVendorPrefixes,l)}}}}return!0},oe.prototype.visitSimpleSelector=function(e){var t=this.documentText.charAt(e.offset);return 1===e.length&&"*"===t&&this.addEntry(e,se.Rules.UniversalSelector),"#"===t&&this.addEntry(e,se.Rules.AvoidIdSelector),!0},oe.prototype.visitImport=function(e){return this.addEntry(e,se.Rules.ImportStatemement),!0},oe.prototype.visitRuleSet=function(e){var t=e.getDeclarations();if(!t)return!1;t.hasChildren()||this.addEntry(e.getSelectors(),se.Rules.EmptyRuleSet);for(var r=[],n=0,i=t.getChildren();n<i.length;n++){if((B=i[n])instanceof le.Declaration){var o=B;r.push(new ue(o.getFullPropertyName().toLowerCase(),o))}}if(0===this.fetch(r,"box-sizing").length){var a=this.fetch(r,"width");if(0<a.length){for(var s=!1,l=0,d=["border","border-left","border-right","padding","padding-left","padding-right"];l<d.length;l++)for(var u=d[l],f=0,h=this.fetch(r,u);f<h.length;f++){(D=(B=h[f]).node.getValue())&&!D.matches("none")&&(this.addEntry(B.node,se.Rules.BewareOfBoxModelSize),s=!0)}if(s)for(var p=0,c=a;p<c.length;p++){var y=c[p];this.addEntry(y.node,se.Rules.BewareOfBoxModelSize)}}var g=this.fetch(r,"height");if(0<g.length){s=!1;for(var v=0,m=["border","border-top","border-bottom","padding","padding-top","padding-bottom"];v<m.length;v++){u=m[v];for(var w=0,x=this.fetch(r,u);w<x.length;w++){(D=(B=x[w]).node.getValue())&&!D.matches("none")&&(this.addEntry(B.node,se.Rules.BewareOfBoxModelSize),s=!0)}}if(s)for(var E=0,P=g;E<P.length;E++){var R=P[E];this.addEntry(R.node,se.Rules.BewareOfBoxModelSize)}}}var k=this.fetchWithValue(r,"display","inline");if(0<k.length)for(var V=0,b=["width","height","margin-top","margin-bottom","float"];V<b.length;V++)for(var S=b[V],N=this.fetch(r,S),I=0;I<N.length;I++){var T=N[I].node,D=T.getValue();("float"!==S||D&&!D.matches("none"))&&this.addEntry(T,se.Rules.PropertyIgnoredDueToDisplay,de("rule.propertyIgnoredDueToDisplayInline","Property is ignored due to the display. With 'display: inline', the width, height, margin-top, margin-bottom, and float properties have no effect."))}if(0<(k=this.fetchWithValue(r,"display","inline-block")).length)for(N=this.fetch(r,"float"),I=0;I<N.length;I++){var F=N[I].node;(D=F.getValue())&&!D.matches("none")&&this.addEntry(F,se.Rules.PropertyIgnoredDueToDisplay,de("rule.propertyIgnoredDueToDisplayInlineBlock","inline-block is ignored due to the float. If 'float' has a value other than 'none', the box is floated and 'display' is treated as 'block'"))}if(0<(k=this.fetchWithValue(r,"display","block")).length)for(N=this.fetch(r,"vertical-align"),I=0;I<N.length;I++)this.addEntry(N[I].node,se.Rules.PropertyIgnoredDueToDisplay,de("rule.propertyIgnoredDueToDisplayBlock","Property is ignored due to the display. With 'display: block', vertical-align should not be used."));var A=this.fetch(r,"float");for(I=0;I<A.length;I++)this.addEntry(A[I].node,se.Rules.AvoidFloat);for(var C=0;C<r.length;C++){var B;if("background"!==(B=r[C]).name)if((D=B.node.getValue())&&"-"!==this.documentText.charAt(D.offset)){var M=this.fetch(r,B.name);if(1<M.length)for(var K=0;K<M.length;K++){var W=M[K].node.getValue();W&&"-"!==this.documentText.charAt(W.offset)&&M[K]!==B&&this.addEntry(B.node,se.Rules.DuplicateDeclarations)}}}for(var L=new fe,O=!1,z=0,U=t.getChildren();z<U.length;z++){var H=U[z];if(this.isCSSDeclaration(H)){var j=(o=H).getFullPropertyName(),q=j.charAt(0);if("-"===q){if("-"!==j.charAt(1)){ae.isKnownProperty(j)||this.addEntry(o.getProperty(),se.Rules.UnknownVendorSpecificProperty);var _=o.getNonPrefixedPropertyName();L.add(_,j,o.getProperty())}}else"*"!==q&&"_"!==q||(this.addEntry(o.getProperty(),se.Rules.IEStarHack),j=j.substr(1)),ae.isKnownProperty(j)||this.addEntry(o.getProperty(),se.Rules.UnknownProperty,de("property.unknownproperty.detailed","Unknown property: '{0}'",j)),L.add(j,j,null)}else O=!0}if(!O)for(var Z in L.data){var G=L.data[Z],J=G.names,Q=ae.isKnownProperty(Z)&&-1===J.indexOf(Z);if(Q||1!==J.length){for(var X=[],Y=(C=0,oe.prefixes.length);C<Y;C++){var $=oe.prefixes[C];ae.isKnownProperty($+Z)&&X.push($+Z)}var ee=this.getMissingNames(X,J);if(ee||Q)for(var te=0,re=G.nodes;te<re.length;te++){var ne=re[te];if(Q){var ie=de("property.standard.missing","Also define the standard property '{0}' for compatibility",Z);this.addEntry(ne,se.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,ie)}if(ee){ie=de("property.vendorspecific.missing","Always include all vendor specific properties: Missing: {0}",ee);this.addEntry(ne,se.Rules.AllVendorPrefixes,ie)}}}}return!0},oe.prototype.visitPrio=function(e){return this.addEntry(e,se.Rules.AvoidImportant),!0},oe.prototype.visitNumericValue=function(e){var t=e.getValue();return t.unit&&-1!==ae.units.length.indexOf(t.unit.toLowerCase())&&0===parseFloat(t.value)&&t.unit&&this.addEntry(e,se.Rules.ZeroWithUnit),!0},oe.prototype.visitFontFace=function(e){var t=e.getDeclarations();if(t){for(var r=!1,n=!1,i=!1,o=0,a=t.getChildren();o<a.length;o++){var s=a[o];if(this.isCSSDeclaration(s)){var l=s.getProperty().getName().toLowerCase();"src"===l&&(r=!0),"font-family"===l&&(n=!0)}else i=!0}return i||r&&n||this.addEntry(e,se.Rules.RequiredPropertiesForFontFace),!0}},oe.prototype.isCSSDeclaration=function(e){if(e instanceof le.Declaration){if(!e.getValue())return!1;var t=e.getProperty();return!(!t||t.getIdentifier().containsInterpolation())}return!1},oe.prototype.visitHexColorValue=function(e){var t=e.length;return 9!==t&&7!==t&&5!==t&&4!==t&&this.addEntry(e,se.Rules.HexColorLength),!1},oe.prototype.visitFunction=function(e){var t=e.getName().toLowerCase(),r=-1,n=0;switch(t){case"rgb(":case"hsl(":r=3;break;case"rgba(":case"hsla(":r=4}return-1!==r&&(e.getArguments().accept(function(e){return!(e instanceof le.BinaryExpression)||(n+=1,!1)}),n!==r&&this.addEntry(e,se.Rules.ArgsInColorFunction)),!0},oe.prefixes=["-ms-","-moz-","-o-","-webkit-"],oe}();t.LintVisitor=r});