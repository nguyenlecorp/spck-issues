!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./languageFacts","./lintRules","../parser/cssNodes","vscode-nls"],e)}(function(e,t){/*---------------------------------------------------------------------------------------------
     *  Copyright (c) Microsoft Corporation. All rights reserved.
     *  Licensed under the MIT License. See License.txt in the project root for license information.
     *--------------------------------------------------------------------------------------------*/
"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./languageFacts"),n=e("./lintRules"),i=e("../parser/cssNodes"),o=e("vscode-nls"),a=o.loadMessageBundle(),s=function(){function e(e,t){this.name=e,this.node=t}return e}(),l=function(){function e(){this.data={}}return e.prototype.add=function(e,t,r){var n=this.data[e];n||(n={nodes:[],names:[]},this.data[e]=n),n.names.push(t),r&&n.nodes.push(r)},e}(),d=function(){function e(e,t){this.warnings=[],this.settings=t,this.documentText=e.getText(),this.keyframes=new l}return e.entries=function(t,r,n,i){var o=new e(r,n);return t.acceptVisitor(o),o.completeValidations(),o.getEntries(i)},e.prototype.fetch=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o.name===t&&r.push(o)}return r},e.prototype.fetchWithValue=function(e,t,r){for(var n=[],i=0,o=e;i<o.length;i++){var a=o[i];if(a.name===t){var s=a.node.getValue();s&&this.findValueInExpression(s,r)&&n.push(a)}}return n},e.prototype.findValueInExpression=function(e,t){var r=!1;return e.accept(function(e){return e.type===i.NodeType.Identifier&&e.getText()===t&&(r=!0),!r}),r},e.prototype.getEntries=function(e){return void 0===e&&(e=i.Level.Warning|i.Level.Error),this.warnings.filter(function(t){return 0!=(t.getLevel()&e)})},e.prototype.addEntry=function(e,t,r){var n=new i.Marker(e,t,this.settings.get(t),r);this.warnings.push(n)},e.prototype.getMissingNames=function(e,t){e=e.slice(0);for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);-1!==n&&(e[n]=null)}for(var i=null,r=0;r<e.length;r++){var o=e[r];o&&(i=null===i?a("namelist.single","'{0}'",o):a("namelist.concatenated","{0}, '{1}'",i,o))}return i},e.prototype.visitNode=function(e){switch(e.type){case i.NodeType.Keyframe:return this.visitKeyframe(e);case i.NodeType.FontFace:return this.visitFontFace(e);case i.NodeType.Ruleset:return this.visitRuleSet(e);case i.NodeType.SimpleSelector:return this.visitSimpleSelector(e);case i.NodeType.Function:return this.visitFunction(e);case i.NodeType.NumericValue:return this.visitNumericValue(e);case i.NodeType.Import:return this.visitImport(e);case i.NodeType.HexColorValue:return this.visitHexColorValue(e);case i.NodeType.Prio:return this.visitPrio(e)}return!0},e.prototype.completeValidations=function(){this.validateKeyframes()},e.prototype.visitKeyframe=function(e){var t=e.getKeyword(),r=t.getText();return this.keyframes.add(e.getName(),r,"@keyframes"!==r?t:null),!0},e.prototype.validateKeyframes=function(){var e=["@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"];for(var t in this.keyframes.data){var r=this.keyframes.data[t].names,i=-1===r.indexOf("@keyframes");if(i||1!==r.length){var o=this.getMissingNames(e,r);if(o||i)for(var s=0,l=this.keyframes.data[t].nodes;s<l.length;s++){var d=l[s];if(i){var u=a("keyframes.standardrule.missing","Always define standard rule '@keyframes' when defining keyframes.");this.addEntry(d,n.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,u)}if(o){var u=a("keyframes.vendorspecific.missing","Always include all vendor specific rules: Missing: {0}",o);this.addEntry(d,n.Rules.AllVendorPrefixes,u)}}}}return!0},e.prototype.visitSimpleSelector=function(e){var t=this.documentText.charAt(e.offset);return 1===e.length&&"*"===t&&this.addEntry(e,n.Rules.UniversalSelector),"#"===t&&this.addEntry(e,n.Rules.AvoidIdSelector),!0},e.prototype.visitImport=function(e){return this.addEntry(e,n.Rules.ImportStatemement),!0},e.prototype.visitRuleSet=function(t){var o=t.getDeclarations();if(!o)return!1;o.hasChildren()||this.addEntry(t.getSelectors(),n.Rules.EmptyRuleSet);for(var d=this,u=[],f=0,h=o.getChildren();f<h.length;f++){var p=h[f];if(p instanceof i.Declaration){var c=p;u.push(new s(c.getFullPropertyName().toLowerCase(),c))}}if(0===this.fetch(u,"box-sizing").length){var y=this.fetch(u,"width");if(y.length>0){for(var g=!1,v=0,m=["border","border-left","border-right","padding","padding-left","padding-right"];v<m.length;v++)for(var w=m[v],x=this.fetch(u,w),E=0,P=x;E<P.length;E++){var p=P[E],R=p.node.getValue();R&&!R.matches("none")&&(this.addEntry(p.node,n.Rules.BewareOfBoxModelSize),g=!0)}if(g)for(var k=0,V=y;k<V.length;k++){var b=V[k];this.addEntry(b.node,n.Rules.BewareOfBoxModelSize)}}var S=this.fetch(u,"height");if(S.length>0){for(var g=!1,N=0,I=["border","border-top","border-bottom","padding","padding-top","padding-bottom"];N<I.length;N++)for(var w=I[N],T=this.fetch(u,w),D=0,F=T;D<F.length;D++){var p=F[D],R=p.node.getValue();R&&!R.matches("none")&&(this.addEntry(p.node,n.Rules.BewareOfBoxModelSize),g=!0)}if(g)for(var A=0,C=S;A<C.length;A++){var B=C[A];this.addEntry(B.node,n.Rules.BewareOfBoxModelSize)}}}var M=this.fetchWithValue(u,"display","inline");if(M.length>0)for(var K=0,W=["width","height","margin-top","margin-bottom","float"];K<W.length;K++)for(var L=W[K],O=d.fetch(u,L),z=0;z<O.length;z++){var U=O[z].node,R=U.getValue();("float"!==L||R&&!R.matches("none"))&&d.addEntry(U,n.Rules.PropertyIgnoredDueToDisplay,a("rule.propertyIgnoredDueToDisplayInline","Property is ignored due to the display. With 'display: inline', the width, height, margin-top, margin-bottom, and float properties have no effect."))}if(M=this.fetchWithValue(u,"display","inline-block"),M.length>0)for(var O=this.fetch(u,"float"),z=0;z<O.length;z++){var H=O[z].node,R=H.getValue();R&&!R.matches("none")&&this.addEntry(H,n.Rules.PropertyIgnoredDueToDisplay,a("rule.propertyIgnoredDueToDisplayInlineBlock","inline-block is ignored due to the float. If 'float' has a value other than 'none', the box is floated and 'display' is treated as 'block'"))}if(M=this.fetchWithValue(u,"display","block"),M.length>0)for(var O=this.fetch(u,"vertical-align"),z=0;z<O.length;z++)this.addEntry(O[z].node,n.Rules.PropertyIgnoredDueToDisplay,a("rule.propertyIgnoredDueToDisplayBlock","Property is ignored due to the display. With 'display: block', vertical-align should not be used."));for(var j=this.fetch(u,"float"),z=0;z<j.length;z++)this.addEntry(j[z].node,n.Rules.AvoidFloat);for(var q=0;q<u.length;q++){var p=u[q];if("background"!==p.name){var R=p.node.getValue();if(R&&"-"!==this.documentText.charAt(R.offset)){var _=this.fetch(u,p.name);if(_.length>1)for(var Z=0;Z<_.length;Z++){var G=_[Z].node.getValue();G&&"-"!==this.documentText.charAt(G.offset)&&_[Z]!==p&&this.addEntry(p.node,n.Rules.DuplicateDeclarations)}}}}for(var J=new l,Q=!1,X=0,Y=o.getChildren();X<Y.length;X++){var $=Y[X];if(this.isCSSDeclaration($)){var c=$,ee=c.getFullPropertyName(),te=ee.charAt(0);if("-"===te){if("-"!==ee.charAt(1)){r.isKnownProperty(ee)||this.addEntry(c.getProperty(),n.Rules.UnknownVendorSpecificProperty);var re=c.getNonPrefixedPropertyName();J.add(re,ee,c.getProperty())}}else"*"!==te&&"_"!==te||(this.addEntry(c.getProperty(),n.Rules.IEStarHack),ee=ee.substr(1)),r.isKnownProperty(ee)||this.addEntry(c.getProperty(),n.Rules.UnknownProperty,a("property.unknownproperty.detailed","Unknown property: '{0}'",ee)),J.add(ee,ee,null)}else Q=!0}if(!Q)for(var ne in J.data){var ie=J.data[ne],oe=ie.names,ae=r.isKnownProperty(ne)&&-1===oe.indexOf(ne);if(ae||1!==oe.length){for(var se=[],q=0,le=e.prefixes.length;q<le;q++){var de=e.prefixes[q];r.isKnownProperty(de+ne)&&se.push(de+ne)}var ue=this.getMissingNames(se,oe);if(ue||ae)for(var fe=0,he=ie.nodes;fe<he.length;fe++){var pe=he[fe];if(ae){var ce=a("property.standard.missing","Also define the standard property '{0}' for compatibility",ne);this.addEntry(pe,n.Rules.IncludeStandardPropertyWhenUsingVendorPrefix,ce)}if(ue){var ce=a("property.vendorspecific.missing","Always include all vendor specific properties: Missing: {0}",ue);this.addEntry(pe,n.Rules.AllVendorPrefixes,ce)}}}}return!0},e.prototype.visitPrio=function(e){return this.addEntry(e,n.Rules.AvoidImportant),!0},e.prototype.visitNumericValue=function(e){var t=e.getValue();return!t.unit||-1===r.units.length.indexOf(t.unit.toLowerCase())||(0===parseFloat(t.value)&&t.unit&&this.addEntry(e,n.Rules.ZeroWithUnit),!0)},e.prototype.visitFontFace=function(e){var t=e.getDeclarations();if(t){for(var r=!1,i=!1,o=!1,a=0,s=t.getChildren();a<s.length;a++){var l=s[a];if(this.isCSSDeclaration(l)){var d=l.getProperty().getName().toLowerCase();"src"===d&&(r=!0),"font-family"===d&&(i=!0)}else o=!0}return o||r&&i||this.addEntry(e,n.Rules.RequiredPropertiesForFontFace),!0}},e.prototype.isCSSDeclaration=function(e){if(e instanceof i.Declaration){if(!e.getValue())return!1;var t=e.getProperty();return!(!t||t.getIdentifier().containsInterpolation())}return!1},e.prototype.visitHexColorValue=function(e){var t=e.length;return 9!==t&&7!==t&&5!==t&&4!==t&&this.addEntry(e,n.Rules.HexColorLength),!1},e.prototype.visitFunction=function(e){var t=e.getName().toLowerCase(),r=-1,o=0;switch(t){case"rgb(":case"hsl(":r=3;break;case"rgba(":case"hsla(":r=4}return-1!==r&&(e.getArguments().accept(function(e){return!(e instanceof i.BinaryExpression)||(o+=1,!1)}),o!==r&&this.addEntry(e,n.Rules.ArgsInColorFunction)),!0},e.prefixes=["-ms-","-moz-","-o-","-webkit-"],e}();t.LintVisitor=d});